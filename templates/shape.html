<!DOCTYPE html>
<html lang="en">
  <head>
    <title>3D Curve</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link type="text/css" rel="stylesheet" href="main.css">
  </head>
  <body>

    <script type="module">

      import * as THREE from "{{ url_for('static', filename='scripts/vendor/three.js-r116/build/three.module.js') }}";

      import Stats from "{{ url_for('static', filename='./scripts/vendor/three.js-r116/examples/jsm/libs/stats.module.js') }}";   
      import { GUI } from "{{ url_for('static', filename='./scripts/vendor/three.js-r116/examples/jsm/libs/dat.gui.module.js') }}";  

      import { OrbitControls } from "{{ url_for('static', filename='./scripts/vendor/three.js-r116/examples/jsm/controls/OrbitControls.js') }}"; 

      var camera, scene, renderer, startTime, object, stats;

      init();
      animate();

      function init() {

	  camera = new THREE.PerspectiveCamera( 36, window.innerWidth / window.innerHeight, 0.25, 1000 );

	  camera.position.set(-50, -20, 100);

	  scene = new THREE.Scene();

          // Line
          var material = new THREE.LineBasicMaterial( {
              color: 0x0000ff,
              linewidth: 3,
          } );

          var points = get_points();

          var geometry = new THREE.BufferGeometry().setFromPoints( points );
          
          object = new THREE.Line( geometry, material );

          scene.add( object );


	  // Stats
	  stats = new Stats();
	  document.body.appendChild( stats.dom );

	  // Renderer
	  renderer = new THREE.WebGLRenderer();
	  renderer.shadowMap.enabled = true;
	  renderer.setPixelRatio( window.devicePixelRatio );
	  renderer.setSize( window.innerWidth, window.innerHeight );
	  window.addEventListener( 'resize', onWindowResize, false );
	  document.body.appendChild( renderer.domElement );

	  // Controls
	  var controls = new OrbitControls( camera, renderer.domElement );
	  controls.target.set(-32, -12, 8); // barycenter of the curve
 	  controls.update();


	  // Start
	  startTime = Date.now();

      }

      function onWindowResize() {

	  camera.aspect = window.innerWidth / window.innerHeight;
	  camera.updateProjectionMatrix();

	  renderer.setSize( window.innerWidth, window.innerHeight );
      }

      function animate() {
	  var currentTime = Date.now();
	  var time = ( currentTime - startTime ) / 1000;

	  requestAnimationFrame( animate );

	  object.position.y = 0.8;
//	  object.rotation.x = time * 0.5;
//	  object.rotation.y = time * 0.2;
//	  object.scale.setScalar( Math.cos( time ) * 0.125 + 0.875 );

	  stats.begin();
	  renderer.render( scene, camera );
	  stats.end();
      }


      function get_points() {
          var points = [];
          
          {% for point in points %}
          points.push( new THREE.Vector3({{point[0]}}, {{point[1]}}, {{point[2]}} ) );
          {% endfor %}
          
          return points;

      }

      
    </script>

  </body>
</html>
